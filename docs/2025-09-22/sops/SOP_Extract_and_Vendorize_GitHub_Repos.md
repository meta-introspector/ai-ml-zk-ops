# SOP: Extract and Vendorize GitHub Repositories

## 1. Purpose

This Standard Operating Procedure (SOP) details the process for extracting unique GitHub repository URLs from a given input file and subsequently forking (vendorizing) them into the `meta-introspector` GitHub organization. This ensures that external dependencies are brought under project control, mitigating supply chain risks and facilitating local development.

## 2. Scope

This SOP applies to any scenario where a list of potential GitHub repository references (e.g., from `grep` output, build logs, or configuration files) needs to be processed to identify unique repositories for vendorization.

## 3. Prerequisites

*   **GitHub CLI (`gh`):** Must be installed and authenticated with sufficient permissions to fork repositories into the `meta-introspector` organization.
*   **`jq`:** Must be installed for JSON processing (though not directly used in the current script, it's a common dependency for related tasks).
*   **Input File:** A file (e.g., `index/all_github.txt`) containing lines that may include GitHub repository URLs (both HTTPS and SSH formats).
*   **`lib/lib_github_fork.sh`:** The `lib_github_fork_repo` function must be available and correctly configured.

## 4. Procedure

### 4.1. Prepare the Input File

Ensure that the input file (`index/all_github.txt` by default) is populated with the raw output containing potential GitHub repository URLs. This file is typically generated by a comprehensive `grep` command across the codebase.

### 4.2. Execute the Extraction and Vendorization Script

Run the `extract_and_vendorize_github_repos.sh` script from the project root directory. You can run it in dry-run (report) mode first to see what actions would be taken without actually performing any forks:

```bash
./scripts/extract_and_vendorize_github_repos.sh --report
```

To perform the actual forking, omit the `--report` flag:

```bash
./scripts/extract_and_vendorize_github_repos.sh
```

### 4.3. Monitor Output

The script will log its progress, including:
*   The number of unique repositories found.
*   Attempts to fork each repository.
*   Success or failure messages for each fork operation.

### 4.4. Review Unique Repositories List

After execution, a file named `index/unique_github_repos.txt` will be created or updated, containing a sorted list of all unique GitHub repository URLs identified and processed.

### 4.5. Verify Forked Repositories

Manually verify on GitHub that the intended repositories have been successfully forked into the `meta-introspector` organization.

### 4.6. Script Quality Assurance

Before executing `scripts/extract_and_vendorize_github_repos.sh`, always run `shellcheck` on it and its dependencies (`lib/lib_github_fork.sh`) to ensure code quality and catch potential errors. Refer to [Memo: Use Shellcheck Always After Changes](../../docs/memos/Shellcheck_Always_After_Changes.md) for details.

```bash
shellcheck scripts/extract_and_vendorize_github_repos.sh
shellcheck lib/lib_github_fork.sh
```

## 5. Troubleshooting

*   **`gh` CLI Authentication/Permissions:** If the script reports errors related to forking, ensure your `gh` CLI is authenticated (`gh auth login`) and has the necessary permissions (e.g., `repo` scope) to create repositories in the `meta-introspector` organization.
*   **Input File Not Found:** Verify that `index/all_github.txt` exists and is correctly populated. The script will exit if this file is missing.
*   **URL Parsing Errors:** If the script warns about not being able to parse owner/repo from URLs, inspect the `index/all_github.txt` file for unexpected formats and adjust the `grep` or `sed` commands within the script if necessary.
*   **Duplicate Forks:** The `lib_github_fork_repo` function is designed to handle cases where a fork already exists, but manual verification is always recommended.

## 6. Related Documents

*   `CRQ_032_Refactor_gh_repo_fork_into_lib.md`
*   `CRQ_016_Submodule_Nixification.md`
*   `lib/lib_github_fork.sh`
*   `index/all_github.txt`
*   `index/unique_github_repos.txt`
